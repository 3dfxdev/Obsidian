
WORK IN PROGRESS
================


!!!  Fix walls
[ handle straddlers first, then do each side of a junction separately ]


!!  for SWITCH-ed doors (etc), require an "action" in the Lua definition
    e.g. action = "OPEN_DOOR_FAST", look it up in GAME.ACTIONS



+  review "svolume" and "innerpoint" usage
   e.g. I think "walk_svol" would be a more useful metric


+  joiners need walls on sides in INDOOR ROOMS too
   -  handle closets and joiners in separate pass in border_up?

   __OR__ handle the STRADDLING junctions first (fences mainly)
          then handle each side SEPARATELY



TRAPS:

+  for each trappable item/goal in a room [ upto max of 2 ]
   decide whether to create a closet trap (using a nearby unused closets)
   or a teleport trap

+  number of traps depends heavily on ROOM.pressure

-  number of traps affected by LEV.game_along

+  do monster depots differently, make "shared" sector based on
   an entry area of second room in the level



CLOSETS:

>>> handle unused closets
    [ A.mode = "void", build walls there, NO EDGE ]

    -  support decorative closets, e.g. fancy light thingy



STAIRS:

+  choose prefabs earlier, probably during floor/ceil heights

-  support two stairs in a rule (to same area)



JOINERS:

+  choose prefab earlier, e.g. during floor/ceil heights or earlier



TELEPORTERS:

+  exclusion zone in front of a closet



SHAPE GRAMMARS:

+  allow TWO conns into a new room (become F1/F2 in CONN object)

+  prune / re-use rooms which remain small, and hallways which
   never end up anywhere else

   [ do this BEFORE converting prelim conns into real conns ]
   
   Q/ what about joiners??

+  symmetrical rooms
   -  find straddling floor chunks in a pre-pass
      [ esp. even width for "wide" sym, odd width if not wide ]

   +  a way to score "straddling" patterns higher
      [ they are a very good place for some stuff, e.g. exits ]
      [[ only first usage of SPROUT/DECOR needs to score higher ]]

   -  SPROUT: if mirrored and new rooms touch/overlap, only create
              a single room



INTRA-ROOM LOCKS

-  if room has a unlocked non-teleporter exit, and we have an unused
   closet --> lock exit with a switch and add a switch closet
   [ and sometimes "trap" the switch closet ]



MISCELLANEOUS:

+  face direction for switches / teleport pads / start pad

+  support 'LEVEL.secret_weapon'

-  titlepic backgrounds (current and new) :
   determine ones for official package, put rest in an addon

-  improve font for titlepic  [ e.g. shaded letters ]



SEMANTICS of ROTATING PREFABS
-----------------------------

1. "point" prefabs are always a square, and will be rotated by a
   multiple of 90 degrees to face a certain direction

   Examples: start pad, teleport pad, exit switch, simple switch,
             crate, pillar, computer.


2. "seeds" prefabs can be square or rectangular.
   
   (a) if they have a shape, then the from_dir determines the
       vertical axis and not other rotations are possible.

       Examples: closets (often U shape)
                 stairs  (often I shape)
                 joiners (often I shape)

       [ some shapes require TWO directions ]

       [ stairs can be rotated 180 degrees to go down instead of up ]

       
   (b) no shape, rotatable

       Example:  lava pit (floor prefab)
                 sky light (ceiling prefab)


Rule: if we have a REQUIRED direction, rotation NOT allowed


